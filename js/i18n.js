export const I18N = {
  en: {
    title: "Followed Artists Playlist",
    intro: "Collect all tracks from artists you follow and create a playlist in your account",
    login: "Log in to Spotify",
    logout: "Log out",
    public: "Make playlist public",
    chronological: "Add in chronological order",
    singles: "Singles only",
    build: "Build and create playlist",
    logTitle: "Log",
    scopes: "Requires scopes: ",
    placeholder: "followed artists: all tracks",
    loggedInAs: "logged in as:",
    ready: "ready â€” click 'build and create playlist'",
    selectAll: "Select all artists",
    selectArtists: "Select artists",
    searchArtists: "Search artists...",
    selectedCount: "Selected: {n}",
    sharePlaylist: "Share playlist",
    showCounts: "Show track counts",
    countsTitle: "Track counts",
    calculating: "Calculating",
    close: "Close",
    rateLimitWait: "rate limited, wait {n}s",
    coverBtn: "Playlist cover",
    coverTitle: "Playlist cover",
    chooseFile: "Choose from device",
    or: "or",
    pasteUrl: "Paste image URL",
    preview: "Preview",
    apply: "Apply",
    removeImage: "Remove image",
    coverHint: "JPEG up to 256 KB. We will compress automatically if needed."
  },
  ru: {
    title: "ÐŸÐ»ÐµÐ¹Ð»Ð¸ÑÑ‚ Ð¸Ð· Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ°Ð½Ð½Ñ‹Ñ… Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ð¾Ð²",
    intro: "Ð¡Ð¾Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²ÑÐµ Ñ‚Ñ€ÐµÐºÐ¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¾Ñ‚ Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ð¾Ð², Ð½Ð° ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð²Ñ‹ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ°Ð½Ñ‹, Ð¸ ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚",
    login: "Ð’Ð¾Ð¹Ñ‚Ð¸ Ð² Spotify",
    logout: "Ð’Ñ‹Ð¹Ñ‚Ð¸",
    public: "Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼",
    chronological: "Ð”Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒ Ð² Ñ…Ñ€Ð¾Ð½Ð¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¾Ð¼ Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ",
    singles: "Ð¢Ð¾Ð»ÑŒÐºÐ¾ ÑÐ¸Ð½Ð³Ð»Ñ‹",
    build: "Ð¡Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð¸ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚",
    logTitle: "Ð›Ð¾Ð³",
    scopes: "Ð¢Ñ€ÐµÐ±ÑƒÑŽÑ‚ÑÑ Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ñ: ",
    placeholder: "Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ°Ð½Ð½Ñ‹Ðµ Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ñ‹: Ð²ÑÐµ Ñ‚Ñ€ÐµÐºÐ¸",
    loggedInAs: "Ð²Ñ‹ Ð²Ð¾ÑˆÐ»Ð¸ ÐºÐ°Ðº:",
    ready: "Ð³Ð¾Ñ‚Ð¾Ð²Ð¾ â€” Ð¶Ð¼Ð¸Ñ‚Ðµ 'ÑÐ¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð¸ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚'",
    selectAll: "Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÐµÑ… Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ð¾Ð²",
    selectArtists: "Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ð¾Ð²",
    searchArtists: "ÐŸÐ¾Ð¸ÑÐº Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ð¾Ð²...",
    selectedCount: "Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð¾: {n}",
    sharePlaylist: "ÐŸÐ¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚Ð¾Ð¼",
    showCounts: "ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ñ€ÐµÐºÐ¾Ð²",
    countsTitle: "ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ñ€ÐµÐºÐ¾Ð²",
    calculating: "Ð˜Ð´Ñ‘Ñ‚ Ð¿Ð¾Ð´ÑÑ‡Ñ‘Ñ‚",
    close: "Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",
    rateLimitWait: "Spotify ÑƒÑÑ‚Ð°Ð», Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð¸Ñ‚Ðµ {n} Ñ.",
    coverBtn: "ÐžÐ±Ð»Ð¾Ð¶ÐºÐ° Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚Ð°",
    coverTitle: "ÐžÐ±Ð»Ð¾Ð¶ÐºÐ° Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚Ð°",
    chooseFile: "Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ñ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°",
    or: "Ð¸Ð»Ð¸",
    pasteUrl: "Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ URL Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ",
    preview: "ÐŸÑ€ÐµÐ´Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€",
    apply: "ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ",
    removeImage: "Ð£Ð±Ñ€Ð°Ñ‚ÑŒ Ð¾Ð±Ð»Ð¾Ð¶ÐºÑƒ",
    coverHint: "JPEG Ð´Ð¾ 256 ÐšÐ‘. ÐœÑ‹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð¶Ð¼Ñ‘Ð¼ Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸."
  },
  uk: {
    title: "ÐŸÐ»ÐµÐ¹Ð»Ð¸ÑÑ‚ Ñ–Ð· Ð¿Ñ–Ð´Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ… Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ñ–Ð²",
    intro: "Ð—Ð±ÐµÑ€Ñ–Ñ‚ÑŒ ÑƒÑÑ– Ñ‚Ñ€ÐµÐºÐ¸ Ð»Ð¸ÑˆÐµ Ð²Ñ–Ð´ Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ñ–Ð², Ð½Ð° ÑÐºÐ¸Ñ… Ð²Ð¸ Ð¿Ñ–Ð´Ð¿Ð¸ÑÐ°Ð½Ñ–, Ñ– ÑÑ‚Ð²Ð¾Ñ€Ñ–Ñ‚ÑŒ Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚",
    login: "Ð£Ð²Ñ–Ð¹Ñ‚Ð¸ Ð² Spotify",
    logout: "Ð’Ð¸Ð¹Ñ‚Ð¸",
    public: "Ð—Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸ Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚ Ð¿ÑƒÐ±Ð»Ñ–Ñ‡Ð½Ð¸Ð¼",
    chronological: "Ð”Ð¾Ð´Ð°Ð²Ð°Ñ‚Ð¸ Ð² Ñ…Ñ€Ð¾Ð½Ð¾Ð»Ð¾Ð³Ñ–Ñ‡Ð½Ð¾Ð¼Ñƒ Ð¿Ð¾Ñ€ÑÐ´ÐºÑƒ",
    singles: "Ð›Ð¸ÑˆÐµ ÑÐ¸Ð½Ð³Ð»Ð¸",
    build: "Ð—Ñ–Ð±Ñ€Ð°Ñ‚Ð¸ Ñ‚Ð° ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚",
    logTitle: "Ð›Ð¾Ð³",
    scopes: "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– Ð´Ð¾Ð·Ð²Ð¾Ð»Ð¸: ",
    placeholder: "Ð¿Ñ–Ð´Ð¿Ð¸ÑÐ°Ð½Ñ– Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ð¸: Ð²ÑÑ– Ñ‚Ñ€ÐµÐºÐ¸",
    loggedInAs: "ÑƒÐ²Ñ–Ð¹ÑˆÐ»Ð¸ ÑÐº:",
    ready: "Ð³Ð¾Ñ‚Ð¾Ð²Ð¾ â€” Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ 'Ð·Ñ–Ð±Ñ€Ð°Ñ‚Ð¸ Ñ‚Ð° ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚'",
    selectAll: "Ð’Ð¸Ð±Ñ€Ð°Ñ‚Ð¸ Ð²ÑÑ–Ñ… Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ñ–Ð²",
    selectArtists: "Ð’Ð¸Ð±Ñ€Ð°Ñ‚Ð¸ Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ñ–Ð²",
    searchArtists: "ÐŸÐ¾ÑˆÑƒÐº Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ñ–Ð²...",
    selectedCount: "Ð’Ð¸Ð±Ñ€Ð°Ð½Ð¾: {n}",
    sharePlaylist: "ÐŸÐ¾Ð´Ñ–Ð»Ð¸Ñ‚Ð¸ÑÑ Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚Ð¾Ð¼",
    showCounts: "ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŒ Ñ‚Ñ€ÐµÐºÑ–Ð²",
    countsTitle: "ÐšÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŒ Ñ‚Ñ€ÐµÐºÑ–Ð²",
    calculating: "Ð™Ð´Ðµ Ð¿Ñ–Ð´Ñ€Ð°Ñ…ÑƒÐ½Ð¾Ðº",
    close: "Ð—Ð°ÐºÑ€Ð¸Ñ‚Ð¸",
    rateLimitWait: "Spotify Ð²Ñ‚Ð¾Ð¼Ð¸Ð²ÑÑ, Ð·Ð°Ñ‡ÐµÐºÐ°Ð¹Ñ‚Ðµ {n} Ñ.",
    coverBtn: "ÐžÐ±ÐºÐ»Ð°Ð´Ð¸Ð½ÐºÐ° Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚Ð°",
    coverTitle: "ÐžÐ±ÐºÐ»Ð°Ð´Ð¸Ð½ÐºÐ° Ð¿Ð»ÐµÐ¹Ð»Ð¸ÑÑ‚Ð°",
    chooseFile: "ÐžÐ±Ñ€Ð°Ñ‚Ð¸ Ð· Ð¿Ñ€Ð¸ÑÑ‚Ñ€Ð¾ÑŽ",
    or: "Ð°Ð±Ð¾",
    pasteUrl: "Ð’ÑÑ‚Ð°Ð²Ñ‚Ðµ URL Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð½Ñ",
    preview: "ÐŸÐ¾Ð¿ÐµÑ€ÐµÐ´Ð½Ñ–Ð¹ Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ´",
    apply: "Ð—Ð°ÑÑ‚Ð¾ÑÑƒÐ²Ð°Ñ‚Ð¸",
    removeImage: "ÐŸÑ€Ð¸Ð±Ñ€Ð°Ñ‚Ð¸ Ð¾Ð±ÐºÐ»Ð°Ð´Ð¸Ð½ÐºÑƒ",
    coverHint: "JPEG Ð´Ð¾ 256 ÐšÐ‘. ÐœÐ¸ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ ÑÑ‚Ð¸ÑÐ½ÐµÐ¼Ð¾ Ð·Ð° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸."
  },
  emoji: {
    title: "ðŸˆðŸŽ§ðŸ“œ",
    intro: "ðŸˆðŸ§²ðŸŽµ -> ðŸ“ðŸ“»",
    login: "ðŸˆðŸ”‘",
    logout: "ðŸšªðŸ‘ˆðŸ»ðŸˆ",
    public: "ðŸˆðŸŒðŸˆâ€â¬›",
    chronological: "ðŸ—“ï¸",
    singles: "ðŸˆðŸŽ¯",
    build: "ðŸˆâš™ï¸âœ…",
    logTitle: "ðŸ±ðŸ“’",
    scopes: "ðŸˆðŸ”: ",
    placeholder: "ðŸˆðŸŽµ:",
    loggedInAs: "ðŸˆ(YOU)",
    ready: "ok â€” tap on ðŸˆâš™ï¸âœ…",
    selectAll: "ðŸˆâœ…ðŸŽ¤",
    selectArtists: "ðŸˆðŸŽ¤âœ…",
    searchArtists: "ðŸ”ŽðŸŽ¤...",
    selectedCount: "âœ… {n}",
    sharePlaylist: "â¤´ï¸âœˆï¸",
    showCounts: "ðŸˆâž•ðŸŽµ",
    countsTitle: "ðŸŽ¤#ðŸŽµ",
    calculating: "â³",
    close: "ðŸ",
    rateLimitWait: "ðŸŒâ³ {n}s",
    coverBtn: "ðŸ–¼ï¸",
    coverTitle: "ðŸ–¼ï¸",
    chooseFile: "ðŸ“±â¬†ï¸",
    or: "or",
    pasteUrl: "ðŸŒ URL",
    preview: "ðŸ‘€",
    apply: "âœ…",
    removeImage: "ðŸ—‘ï¸",
    coverHint: "JPEG â‰¤256KB"
  }
};

export function applyI18n(lang) {
  const dict = I18N[lang] || I18N.en;
  const fmt = (key, params = {}) => {
    let s = dict[key] || I18N.en[key] || "";
    Object.keys(params).forEach(k => { s = s.replace(new RegExp(`\\{${k}\\}`, "g"), params[k]); });
    return s;
  };

  document.querySelectorAll("[data-i18n]").forEach(el => {
    const k = el.getAttribute("data-i18n");
    if (k === "selectedCount") {
      const n = el.getAttribute("data-i18n-arg-n") || "0";
      el.textContent = fmt(k, { n });
    } else if (dict[k]) {
      el.textContent = dict[k];
    }
  });
  document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
    const k = el.getAttribute("data-i18n-placeholder");
    if (dict[k]) el.setAttribute("placeholder", dict[k]);
  });
  const inp = document.getElementById("playlistName");
  if (inp && (!inp.value || inp.value === inp.getAttribute("data-prev"))) {
    inp.value = dict.placeholder;
  }
  if (inp) {
    inp.placeholder = dict.placeholder;
    inp.setAttribute("data-prev", dict.placeholder);
  }
  document.documentElement.setAttribute("lang", lang);
  const sel = document.getElementById("lang");
  if (sel && sel.value !== lang) sel.value = lang;
  localStorage.setItem("lang", lang);
}

export function getPreferredLang() {
  const saved = localStorage.getItem("lang");
  if (saved && I18N[saved]) return saved;
  const nav = (navigator.language || "en").toLowerCase();
  if (nav.startsWith("ru")) return "ru";
  if (nav.startsWith("uk") || nav.startsWith("ua")) return "uk";
  return "en";
}